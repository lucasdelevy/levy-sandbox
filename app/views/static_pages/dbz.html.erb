<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <%= stylesheet_link_tag "css/main.css" %>
  <title>About me | levy's sandbox</title>

  <script>
    var
    max_size = 600,
    font = '6vw arial',
    first_color = 'black',
    second_color = 'yellow',
    textpos_x = .5, // text x position in percentage
    textpos_y = .6 // text y position in percentage
    
    download = function (canvas, filename)
    {
      var
      lnk = document.createElement('a'),
      e;

      lnk.download = filename;

      lnk.href = canvas.toDataURL();

      if (document.createEvent)
      {
        e = document.createEvent("MouseEvents");
        e.initMouseEvent("click", true, true, window,
                         0, 0, 0, 0, 0, false, false, false,
                         false, 0, null);

        lnk.dispatchEvent(e);
      }
      else if (lnk.fireEvent)
        lnk.fireEvent("onclick");
    }

    editImage = function(e)
    {
      var img = new Image();
      img.src = '/assets/dbz_original.png';

      img.onload = function()
      {
        var
        r = max_size/Math.max(this.width,this.height),
        w = Math.round(this.width*r),
        h = Math.round(this.height*r),
        c = document.createElement("canvas"), cc = c.getContext("2d");
        c.width = w;
        c.height = h;
        cc.drawImage(this,0,0,w,h);

        cc.font = font;
        cc.textAlign = 'center';
        cc.fillStyle = first_color;
        cc.fillText(document.getElementById('text_input').value.toUpperCase(), textpos_x*w+2, textpos_y*h+2);
        cc.fillStyle = second_color;
        cc.fillText(document.getElementById('text_input').value.toUpperCase(),textpos_x*w, textpos_y*h);

        document.getElementById('text_input').value = ''
        document.getElementById('text_input').placeholder = ''

        document.getElementById('img_result').src = c.toDataURL();

        download(c, 'result.png')
      }
    }
    
    window.onload = function()
    {
      document.getElementById('save_button').addEventListener('click',editImage);
    }
  </script>

  <style>
    .image
    {
      position: relative;
      width: 100%;
    }

    #text_input
    {
      position: absolute;
      top: 50%;
      left: 0vw;
      width: 100%;
      height: 50%;
      text-align: center;
      vertical-align: middle;
      text-transform: uppercase;
      background-color: transparent;
      border-color: transparent;
      font: 6vw arial;
      color: yellow;
      text-shadow: 2px 2px black;
    }
    #text_input:focus
    {
      outline: none;
    }
  </style>
</head>

<body>
  <div class='header'> <%= render "layouts/header" %></div>
  <div class='wrapper'>
      <header class="post-header">
        <h1 class="post-title">canvas</h1>
      </header>
      <div class="post-content">
        <center>
        <div class='image'>
          <img src = "/assets/dbz_original.png" id = "img_result" width = "500">
          <textarea id="text_input" placeholder="add text here" autofocus="true"></textarea>
        </div>
        <input type="button" id="save_button" value="download">
        </center>
      </div>
  </div>
</body
><footer><%= render "layouts/footer" %></footer>

</html>